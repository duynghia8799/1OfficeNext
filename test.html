<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <title>Scroll Test - Vanilla JS</title>
    <style>
        body {
            font-family: sans-serif;
            margin: 0;
        }

        .spacer {
            height: 100vh;
            background: #f0f0f0;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* Layout */
        .container {
            display: flex;
            max-width: 1000px;
            margin: 0 auto;
            position: relative;
            /* Quan trọng */
        }

        /* Cột bên trái */
        .text-column {
            width: 50%;
            padding: 50px 20px;
            box-sizing: border-box;
        }

        .text-block {
            height: 400px;
            border: 2px solid #ddd;
            margin-bottom: 50px;
            padding: 20px;
            transition: all 0.3s;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        .text-block.active {
            border-color: red;
            background-color: #fff5f5;
        }

        /* Cột bên phải (Sticky) */
        .image-column {
            width: 50%;
            position: relative;
            /* Context cho sticky */
        }

        .sticky-wrapper {
            position: sticky;
            top: 50vh;
            /* Giữa màn hình */
            transform: translateY(-50%);
            /* Căn giữa tâm */
            display: flex;
            justify-content: center;
        }

        .my-image-box {
            width: 300px;
            height: 300px;
            background-color: #ccc;
            color: #fff;
            font-size: 80px;
            font-weight: bold;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 20px;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
            transition: background-color 0.5s ease;
        }
    </style>
</head>

<body>

    <div class="spacer">
        <h1>Cuộn xuống dưới để bắt đầu...</h1>
    </div>

    <div class="container">
        <!-- Cột Nội Dung -->
        <div class="text-column">
            <div class="text-block" data-id="1" data-color="#FF5733">
                <h2>Khối Số 1</h2>
                <p>Màu CAM (#FF5733)</p>
            </div>
            <div class="text-block" data-id="2" data-color="#33FF57">
                <h2>Khối Số 2</h2>
                <p>Màu XANH LÁ (#33FF57)</p>
            </div>
            <div class="text-block" data-id="3" data-color="#3357FF">
                <h2>Khối Số 3</h2>
                <p>Màu XANH DƯƠNG (#3357FF)</p>
            </div>
        </div>


        <div class="image-column">
            <div class="sticky-wrapper">
                <div id="targetBox" class="my-image-box">1</div>
            </div>
        </div>
    </div>

    <div class="spacer">
        <h1>Hết rồi.</h1>
    </div>

    <script>
        document.addEventListener("DOMContentLoaded", function () {

            // 1. Cấu hình Observer
            const observerOptions = {
                root: null,
                // Thu hẹp vùng nhìn vào khoảng giữa màn hình để bắt chính xác hơn
                rootMargin: '-50% 0px -50% 0px',
                threshold: 0
            };

            // 2. Định nghĩa hàm xử lý khi có va chạm
            const observerCallback = (entries, observer) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        const target = entry.target;

                        // Active class cho text
                        document.querySelectorAll('.text-block').forEach(el => el.classList.remove('active'));
                        target.classList.add('active');

                        // Lấy dữ liệu
                        const id = target.getAttribute('data-id');
                        const color = target.getAttribute('data-color');

                        // Cập nhật hộp bên phải
                        const box = document.getElementById('targetBox');
                        if (box) {
                            box.innerText = id;
                            box.style.backgroundColor = color;
                        }
                    }
                });
            };

            // 3. Khởi tạo Observer
            const observer = new IntersectionObserver(observerCallback, observerOptions);

            // 4. Bắt đầu theo dõi các khối text
            const elements = document.querySelectorAll('.text-block');
            elements.forEach(el => observer.observe(el));
        });
    </script>
</body>

</html>